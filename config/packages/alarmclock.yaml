# Alarm Clock Module
# https://github.com/jjmontesl/home-assistant-config/blob/master/config/packages/alarmclock.yaml


##################################################
## Inputs
##################################################

input_boolean:
  alarmclock_wd_enabled:
    name: Activer
    initial: off
    icon: mdi:toggle-switch
    
input_number:
  alarmclock_wd_hour:
    name: Heure
    icon: mdi:timer
    initial: 7
    min: 0
    max: 23
    step: 1
  alarmclock_wd_minute:
    name: Minute
    icon: mdi:timer
    initial: 30
    min: 0
    max: 55
    step: 5



##################################################
## Sensors
##################################################

sensor:
  - platform: template
    sensors:
      alarmclock_wd_time_template:
        friendly_name: 'Alarme'
        icon_template: "{{ 'mdi:alarm' if is_state('input_boolean.alarmclock_wd_enabled', 'on') else 'mdi:close-circle' }}"
        value_template: '{{ "%0.02d:%0.02d" | format(states("input_number.alarmclock_wd_hour") | int, states("input_number.alarmclock_wd_minute") | int) }}'
        
##################################################
## Automations
##################################################

automation:
  - alias: Alarm Clock
    initial_state: 'on'
    trigger:
      - platform: time
        minutes: '/1'
        seconds: 00

    condition:
      condition: or
      conditions:
        - condition: and
          conditions:
          - condition: template
            value_template: '{{ now().time().strftime("%H:%M") == states.sensor.alarmclock_wd_time_template.state }}'
          - condition: state
            entity_id: input_boolean.alarmclock_wd_enabled
            state: 'on'
          - condition: state
            entity_id: binary_sensor.workday_sensor
            state: 'on'
    action:
      - service: script.alarmclock_ring


##################################################
## Scripts
##################################################

script:
  alarmclock_ring:
    alias: Ring Alarm
    sequence:
      - service: script.wakeup

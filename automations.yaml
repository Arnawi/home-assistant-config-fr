######################################################################################################################  
######################################################################################################################    
#  RESTART TRIGGER
###################################################################################################################### 
###################################################################################################################### 
- alias: 'hub trigger'
  initial_state: on
  trigger:
    - platform: homeassistant
      event: start
  action:
    - delay:
        seconds: 10  
    - service: automation.trigger
      entity_id: automation.remote_external_update_harmony_hub
      
- alias: 'Turn on tplink1'
  initial_state: on
  trigger:    
    - platform: state
      entity_id: switch.tplink_1
      from: 'off'
      to: 'on'      
  action: 
    - delay: 
        seconds: 50  
    - service: remote.send_command
      entity_id: remote.harmony_hub
      data:
        device: "50272082"
        command: "PowerOff"     
    - service: script.turn_on
      entity_id: script.zappiti_power_off
    - service: light.turn_off
      entity_id: light.strip_2
    - service: light.turn_off
      entity_id: light.strip_3            
    - service: light.turn_off
      entity_id: light.play_1
    - service: light.turn_off
      entity_id: light.play_2   

######################################################################################################################  
######################################################################################################################    
#  HARMONY SCENES LIGHTS
###################################################################################################################### 
######################################################################################################################
- alias: 'MOVIES Dimmed'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'   
  action:
    service: scene.turn_on
    entity_id: scene.livingroom_dim
     
- alias: 'PC Dimmed'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}' 
  action:
    service: scene.turn_on
    entity_id: scene.livingroom_dim
     
- alias: 'PS4 Dimmed'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "PS4" }}' 
  action:
    service: scene.turn_on
    entity_id: scene.livingroom_dim
     
- alias: 'ONE Dimmed'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}' 
  action:
    service: scene.turn_on
    entity_id: scene.livingroom_dim
     
- alias: 'SWITCH Dimmed'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH" }}' 
  action:
    service: scene.turn_on
    entity_id: scene.livingroom_dim
     
- alias: 'PowerOff MOVIES Light On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'MOVIES'
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
  action:
    - service: scene.turn_on
      data:
        entity_id: scene.livingroom_normal
     
- alias: 'PowerOff PC Light On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'PC'
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
  action:
    - service: scene.turn_on
      data:
        entity_id: scene.livingroom_normal
 
- alias: 'PowerOff PS4 Light On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'PS4'
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
  action:
    - service: scene.turn_on
      data:
        entity_id: scene.livingroom_normal
    
- alias: 'PowerOff ONE TV Light On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'ONE'
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
  action:  
    - service: scene.turn_on
      data:
        entity_id: scene.livingroom_normal

- alias: 'PowerOff SWITCH Light On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'SWITCH'
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
  action:  
    - service: scene.turn_on
      data:
        entity_id: scene.livingroom_normal

######################################################################################################################  
######################################################################################################################    
#  EMULATED ROKU LIGHT
###################################################################################################################### 
######################################################################################################################  
- alias: 'ROKU Play'
  initial_state: on
  trigger:
    - platform: event
      event_type: roku_command
      event_data:
        roku_usn: baQ5vE2xTNZGM8q5kWb7C2
        type: keypress
        key: Play
  action:
    - service: scene.turn_on
      entity_id: scene.livingroom_off
    - service: remote.send_command
      entity_id: remote.Harmony_Hub
      data:
        device: "50272082"
        command: "Play"   
     
- alias: 'ROKU stop'
  initial_state: on
  trigger:
    - platform: event
      event_type: roku_command
      event_data:
        roku_usn: baQ5vE2xTNZGM8q5kWb7C2
        type: keypress
        key: Back
  action:
    - service: scene.turn_on
      entity_id: scene.livingroom_dim
    - service: remote.send_command
      entity_id: remote.Harmony_Hub
      data:
        device: "50272082"
        command: "Back"     

######################################################################################################################  
######################################################################################################################    
#  INPUT SELECT
###################################################################################################################### 
######################################################################################################################
  ###  TV  ###
- alias: Remote start activity from input select TV
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_select.tv_input_select
  action:
    - service: homeassistant.turn_on
      data_template:
        entity_id: >
         {% if is_state('input_select.tv_input_select', 'PowerOff') %}
         script.1515353133084
         {% elif is_state('input_select.tv_input_select', 'HDMI 1') %}
         script.1515352997947
         {% elif is_state('input_select.tv_input_select', 'HDMI 2') %}
         script.1515352957625
         {% elif is_state('input_select.tv_input_select', 'HDMI 3') %}
         script.1515337890501
         {% elif is_state('input_select.tv_input_select', 'HDMI 4') %}
         script.tvhdmi4
         {% elif is_state('input_select.tv_input_select', 'TV') %}
         script.tvinputtv
         {% endif %}

  ###  AMP  ###                    
- alias: Remote start activity from input select AMP
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_select.amp_input_select
  action:
    - service: homeassistant.turn_on
      data_template:
        entity_id: >
         {% if is_state('input_select.amp_input_select', 'PowerOff') %}
         script.amp_power_off
         {% elif is_state('input_select.amp_input_select', 'PC') %}
         script.amp_pc
         {% elif is_state('input_select.amp_input_select', 'APPLE TV') %}
         script.amp_apple_tv
         {% elif is_state('input_select.amp_input_select', 'PS4') %}
         script.amp_ps4
         {% elif is_state('input_select.amp_input_select', 'RETRO') %}
         script.amp_retro
         {% elif is_state('input_select.amp_input_select', '360') %}
         script.amp_360
         {% elif is_state('input_select.amp_input_select', 'ZAPPITI') %}
         script.amp_zappiti
         {% elif is_state('input_select.amp_input_select', 'SWITCH') %}
         script.amp_switch
         {% elif is_state('input_select.amp_input_select', 'CHROMECAST') %}
         script.amp_chromecast
         {% elif is_state('input_select.amp_input_select', 'MUSICAST') %}
         script.amp_musicast
         {% endif %}

- alias: Remote external update AMP
  initial_state: on
  trigger: 
    - platform: template
      value_template: "{{ is_state_attr('media_player.home_cinema_main', 'source', 'av1') }}"
    - platform: template
      value_template: "{{ is_state_attr('media_player.home_cinema_main', 'source', 'av2') }}"
    - platform: template
      value_template: "{{ is_state_attr('media_player.home_cinema_main', 'source', 'av3') }}"
    - platform: template
      value_template: "{{ is_state_attr('media_player.home_cinema_main', 'source', 'av4') }}"     
    - platform: template
      value_template: "{{ is_state_attr('media_player.home_cinema_main', 'source', 'av5') }}"
    - platform: template
      value_template: "{{ is_state_attr('media_player.home_cinema_main', 'source', 'av6') }}"     
    - platform: template
      value_template: "{{ is_state_attr('media_player.home_cinema_main', 'source', 'av7') }}"
    - platform: template
      value_template: "{{ is_state_attr('media_player.home_cinema_main', 'source', 'audio2') }}"     
    - platform: template
      value_template: "{{ is_state_attr('media_player.home_cinema_main', 'source', 'server') }}"            
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.amp_input_select
        option: >
          {% if is_state_attr('media_player.home_cinema_main', 'source', 'av1') %}
          PC         
          {% elif is_state_attr('media_player.home_cinema_main', 'source', 'av2') %}
          APPLE TV
          {% elif is_state_attr('media_player.home_cinema_main', 'source', 'av3') %}
          PS4
          {% elif is_state_attr('media_player.home_cinema_main', 'source', 'av4') %}
          RETRO
          {% elif is_state_attr('media_player.home_cinema_main', 'source', 'av5') %}
          360
          {% elif is_state_attr('media_player.home_cinema_main', 'source', 'av6') %}
          ZAPPITI
          {% elif is_state_attr('media_player.home_cinema_main', 'source', 'av7') %}
          SWITCH
          {% elif is_state_attr('media_player.home_cinema_main', 'source', 'audio2') %}
          CHROMECAST
          {% elif is_state_attr('media_player.home_cinema_main', 'source', 'server') %}
          MUSICAST           
          {% endif %}

  ###  HARMONY HUB ###
- alias: Remote start activity from input select Harmony
  initial_state: on
  trigger: 
    - platform: state
      entity_id: input_select.harmony_hub
  action:
    - service: script.turn_on
      entity_id: script.input_select_harmony
       
- alias: Remote external update Harmony Hub
  initial_state: on
  trigger: 
    - platform: state
      entity_id: remote.harmony_hub
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.harmony_hub
        option: >
          {{ states.remote.harmony_hub.attributes.current_activity }}  

- alias: 'PowerOff input select update harmony hub'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_select.harmony_hub
  condition:  
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'PowerOff'
  action:
    - service: script.turn_on
      entity_id: script.activity_off                

- alias: 'PowerOff harmony hub update input select'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:  
    - condition: state
      entity_id: remote.harmony_hub
      state: 'off'
  action:  
    - service: input_select.select_option
      data_template:
        entity_id: input_select.harmony_hub
        option: 'PowerOff' 

  ###  THEMES  ###         
- alias: Hass Theme 
  initial_state: 'on'
  trigger: 
    - platform: state
      entity_id: input_select.hass_theme
  action:
    - service: frontend.set_theme
      data_template:
       name: "{{ states.input_select.hass_theme.state }}"
       
######################################################################################################################  
######################################################################################################################    
#  UPDATE INPUT SELECT
###################################################################################################################### 
######################################################################################################################      
  ###  TV  ###

- alias: 'Update input TV OFF'
  initial_state: on
  trigger:    
    - platform: state
      entity_id: sensor.qled_tv_template
  condition:
    condition: and
    conditions:   
      - condition: state
        entity_id: sensor.qled_tv_template
        state: 'off'
      - condition: state
        entity_id: remote.harmony_hub
        state: 'off'         
  action: 
    - service: input_select.select_option
      data:
        entity_id: input_select.tv_input_select   
        option: PowerOff  

- alias: 'Update input TV OFF'
  initial_state: on
  trigger:    
    - platform: state
      entity_id: sensor.qled_tv_template
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: remote.harmony_hub
        state: 'off'         
  action: 
    - service: input_select.select_option
      data:
        entity_id: input_select.tv_input_select   
        option: PowerOff                   
        
- alias: 'Update input TV hdmi 1'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_select.harmony_hub
  condition:     
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'ONE TV' 
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'ONE'      
  action: 
    - service: input_select.select_option
      data:
        entity_id: input_select.tv_input_select   
        option: HDMI 1   
        
- alias: 'Update input TV hdmi 2'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_select.harmony_hub
  condition:     
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'APPLE TV'      
  action: 
    - service: input_select.select_option
      data:
        entity_id: input_select.tv_input_select   
        option: HDMI 2   
        
- alias: 'Update input TV hdmi 3'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_select.harmony_hub
  condition: 
    - condition: state
      entity_id: input_select.harmony_hub
      state: 'SMART TV'  
  action: 
    - service: input_select.select_option
      data:
        entity_id: input_select.tv_input_select   
        option: HDMI 3               
        
- alias: 'Update input TV hdmi 4'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_select.harmony_hub
  condition: 
    condition: or
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'PC TV'        
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'PS4 TV'   
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'MOVIES TV'      
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'SWITCH TV' 
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'RETRO TV'  
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'PC' 
      - condition: state
        entity_id: input_select.harmony_hub
        state: '360 TV'         
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'PS4'   
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'MOVIES'      
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'SWITCH' 
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'RETRO'          
  action: 
    - service: input_select.select_option
      data:
        entity_id: input_select.tv_input_select   
        option: HDMI 4            

  ###  AMP  ###        
- alias: 'PowerOff update AMP'
  initial_state: on
  trigger:
    - platform: state
      entity_id: media_player.home_cinema_main
  condition:
    - condition: state
      entity_id: media_player.home_cinema_main
      state: 'off'
  action:   
    - service: input_select.select_option
      data_template:
        entity_id: input_select.amp_input_select
        option: 'PowerOff'     

######################################################################################################################  
######################################################################################################################    
#  INPUT NUMBER
###################################################################################################################### 
######################################################################################################################      
  ###  GOOGLE HOME MINI  ###         
- alias: Set Goggle Home Mini Slider Position
  initial_state: on
  trigger:
    - platform: state
      entity_id: media_player.chambre
  condition:
    - condition: template
      value_template: "{{ not is_state_attr('media_player.chambre', 'volume_level', states('input_number.google_home_mini') | int / 100) }}"
  action:
    - service: input_number.set_value
      entity_id: input_number.google_home_mini
      data_template:
        value: "{{ trigger.to_state.attributes.volume_level | multiply(100) | int }}"

- alias: Set Goggle Home Mini Volume
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_number.google_home_mini
  condition:
    - condition: template
      value_template: "{{ not is_state_attr('media_player.chambre', 'volume_level', states('input_number.google_home_mini') | int / 100) }}"
  action:
    - service: media_player.volume_set
      entity_id: media_player.chambre
      data_template:
        volume_level: "{{ states('input_number.google_home_mini') | int / 100 }}"
  
  ###  GOOGLE HOME  ###          
- alias: Set Goggle Home Slider Position
  initial_state: on
  trigger:
    - platform: state
      entity_id: media_player.salon_2
  condition:
    - condition: template
      value_template: "{{ not is_state_attr('media_player.salon_2', 'volume_level', states('input_number.google_home') | int / 100) }}"
  action:
    - service: input_number.set_value
      entity_id: input_number.google_home
      data_template:
        value: "{{ trigger.to_state.attributes.volume_level | multiply(100) | int }}"

- alias: Set Goggle Home Volume
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_number.google_home
  condition:
    - condition: template
      value_template: "{{ not is_state_attr('media_player.salon_2', 'volume_level', states('input_number.google_home') | int / 100) }}"
  action:
    - service: media_player.volume_set
      entity_id: media_player.salon_2
      data_template:
        volume_level: "{{ states('input_number.google_home') | int / 100 }}"

######################################################################################################################  
######################################################################################################################    
#  INPUT BOOLEAN
###################################################################################################################### 
######################################################################################################################
  ###  TV  ###
- alias: 'TV On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.tv_power_switch
      to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.tv_on
     
- alias: 'TV Off'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.tv_power_switch
      to: 'off'
  action:
    - service: script.turn_on
      entity_id: script.1515353133084

- alias: 'TV Volume Up'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.tv_volume
      to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.tvvolumeup
     
- alias: 'TV Volume Down'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.tv_volume
      to: 'off'
  action:
    - service: script.turn_on
      entity_id: script.tvvolumedown

  ###  AMP  ###       
- alias: 'AMP On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.amp_power_switch
      to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.amp_power_on
     
- alias: 'AMP Off'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.amp_power_switch
      to: 'off'
  action:
    - service: script.turn_on
      entity_id: script.amp_power_off

  ###  ONE  ###
- alias: 'One On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.one_power_switch
      to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.1515356098614
     
- alias: 'One Off'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.one_power_switch
      to: 'off'
  action:
    - service: script.turn_on
      entity_id: script.1515353304047  

  ###  ZAPPITI  ###      
- alias: 'Zappiti On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.zappiti_power_switch
      to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.zappiti_power_on
     
- alias: 'Zappiti Off'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.zappiti_power_switch
      to: 'off'
  action:
    - service: script.turn_on
      entity_id: script.zappiti_power_off    

  ###  ASTRO  ###
- alias: 'Astro On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.astro_power_switch
      to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.astro_power_on
    
- alias: 'Astro Off'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.astro_power_switch
      to: 'off'
  action:
    - service: script.turn_on
      entity_id: script.astro_power_off  

  ###  ALARM  ###      
- alias: 'alarm light on'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_light
      to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.light_flash
    
- alias: 'alarm light off'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_light
      to: 'off'
  action:
    - service: script.turn_on
      entity_id: script.cancel_loop         

######################################################################################################################  
######################################################################################################################    
#  BOOLEAN UPDATE
###################################################################################################################### 
######################################################################################################################
  ###  TV  ### 
- alias: 'Update Boolean TV ON'
  initial_state: on
  trigger:
    - platform: state
      entity_id: sensor.qled_tv_template
      from: 'off'
      to: 'on'
  action:   
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.tv_power_switch  

- alias: 'Update Boolean TV OFF'
  initial_state: on
  trigger:    
    - platform: state
      entity_id: sensor.qled_tv_template
      from: 'on'
      to: 'off'
  action:    
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.tv_power_switch

  ###  ZAPPITI  ###    
- alias: 'Update Boolean ZAPPITI ON'
  initial_state: on
  trigger:
    - platform: state
      entity_id: sensor.zappiti_template
      from: 'off'
      to: 'on'
  action: 
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.zappiti_power_switch

- alias: 'Update Boolean ZAPPITI OFF'
  initial_state: on
  trigger:
    - platform: state
      entity_id: sensor.zappiti_template
      from: 'on'
      to: 'off'
  action: 
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.zappiti_power_switch
       
  ###  AMP  ###       
- alias: 'Update Boolean AMP ON'
  initial_state: on
  trigger:
    - platform: state
      entity_id: media_player.home_cinema_main
  condition:
    - condition: state
      entity_id: media_player.home_cinema_main
      state: 'on'
  action: 
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.amp_power_switch
        
- alias: 'Update Boolean AMP OFF'
  initial_state: on
  trigger:
    - platform: state
      entity_id: media_player.home_cinema_main
  condition:
    - condition: state
      entity_id: media_player.home_cinema_main
      state: 'off'
  action:    
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.amp_power_switch
           
######################################################################################################################  
######################################################################################################################    
#  PS4
###################################################################################################################### 
######################################################################################################################  
- alias: 'Turn on sonoff4 when PS4 TV'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "PS4 TV" }}'    
  action:
    service: switch.turn_on
    entity_id: switch.sonoff4   
- alias: 'PowerOff PS4 TV and sonoff4'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'PS4 TV'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "APPLE TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH TV" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SMART TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "360 TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO TV" }}'     
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO" }}'     
  action:
    - service: switch.turn_off
      entity_id: switch.sonoff4
- alias: 'Turn on sonoff4 when PS4'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "PS4" }}'    
  action:
    service: switch.turn_on
    entity_id: switch.sonoff4    
- alias: 'PowerOff PS4 and sonoff4'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'PS4'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "APPLE TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH TV" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SMART TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "360 TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO TV" }}'     
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO" }}'   
  action:
    - service: switch.turn_off
      entity_id: switch.sonoff4

######################################################################################################################  
######################################################################################################################    
#  APPLE TV
###################################################################################################################### 
######################################################################################################################
- alias: 'Turn on sonoff1 when APPLE TV'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "APPLE TV" }}'   
  action:
    service: switch.turn_on
    entity_id: switch.sonoff1
- alias: 'PowerOff Apple TV and sonoff1'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'APPLE TV'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4 TV" }}'  
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4" }}'             
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH TV" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SMART TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "360 TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO TV" }}'     
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO" }}'   
  action:
    - service: switch.turn_off
      entity_id: switch.sonoff1
      
######################################################################################################################  
######################################################################################################################    
#  CHROMECAST
###################################################################################################################### 
######################################################################################################################
- alias: 'Turn on sonoff2 when Chromecast'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'   
  action:
    service: switch.turn_on
    entity_id: switch.sonoff2    
- alias: 'PowerOff Chromecast and sonoff2'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'CHROMECAST'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "APPLE TV" }}'            
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4 TV" }}'  
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4" }}'             
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH TV" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SMART TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "360 TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO TV" }}'     
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO" }}' 
  action:
    - service: switch.turn_off
      entity_id: switch.sonoff2
      
######################################################################################################################  
######################################################################################################################    
#  SWITCH
###################################################################################################################### 
######################################################################################################################      
- alias: 'Turn on sonoff3 when SWITCH'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH" }}'   
  action:
    service: switch.turn_on
    entity_id: switch.sonoff3    
- alias: 'PowerOff Switch and sonoff3'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'SWITCH'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "APPLE TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4 TV" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SMART TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "360 TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO TV" }}'     
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO" }}'            
  action:
    - service: switch.turn_off
      entity_id: switch.sonoff3      
- alias: 'Turn on sonoff3 when SWITCH TV'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH TV" }}'   
  action:
    service: switch.turn_on
    entity_id: switch.sonoff3   
- alias: 'PowerOff SWITCH TV and sonoff3'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'SWITCH TV'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "APPLE TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4 TV" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SMART TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "360 TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO TV" }}'     
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO" }}'       
  action:
    - service: switch.turn_off
      entity_id: switch.sonoff3   

######################################################################################################################  
######################################################################################################################    
#  360 TV
###################################################################################################################### 
######################################################################################################################
- alias: 'Turn on multi when 360 TV'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "360 TV" }}'   
  action:
    - service: light.turn_on
      entity_id: light.multi
    - delay:
        seconds: 5  
    -  service: script.turn_on
       entity_id: script.360_power_on     
- alias: 'PowerOff 360 TV and multi'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: '360 TV'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "APPLE TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4 TV" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SMART TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH" }}'             
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}'           
  action:
    - service: light.turn_off
      entity_id: light.multi

######################################################################################################################  
######################################################################################################################    
#  RETRO
###################################################################################################################### 
######################################################################################################################
- alias: 'Turn on multi when RETRO'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO" }}'   
  action:
    service: light.turn_on
    entity_id: light.multi   
- alias: 'PowerOff RETRO and multi'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'RETRO'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "APPLE TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4 TV" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SMART TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH" }}'             
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}'       
  action:
    - service: light.turn_off
      entity_id: light.multi      
- alias: 'Turn on RETRO TV when harmony_hub'
  initial_state: on 
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    - condition: template
      value_template: '{{ trigger.to_state.attributes.current_activity == "RETRO TV" }}'   
  action:
    service: light.turn_on
    entity_id: light.multi    
- alias: 'PowerOff RETRO TV'
  initial_state: on
  trigger:
    - platform: state
      entity_id: remote.harmony_hub
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.harmony_hub
        state: 'RETRO TV'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
          - condition: template      
            value_template: '{{ trigger.to_state.attributes.current_activity == "APPLE TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4 TV" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SMART TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC TV" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "SWITCH" }}'             
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES TV" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "ONE" }}'    
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "MOVIES" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PS4" }}'   
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "CHROMECAST" }}'
          - condition: template
            value_template: '{{ trigger.to_state.attributes.current_activity == "PC" }}'       
  action:
    - service: light.turn_off
      entity_id: light.multi            

######################################################################################################################  
######################################################################################################################    
#  PYTHON SCRIPT SUMMARY
###################################################################################################################### 
######################################################################################################################        
- alias: 'Activity change'
  hide_entity: True
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: input_select.harmony_hub
  action:
    - service: python_script.activity
      data_template:
        event: "{{ trigger.event }}"
    - service: python_script.summary
      data_template:
        event: "{{ trigger.event }}"
        
- alias: 'Call Script Event'
  hide_entity: True
  initial_state: 'on'
  trigger:
    - platform: event
      event_type: call_service
      event_data:
        domain: script
  action:
    - delay: 00:00:02
    - service: python_script.last_cmd
      data_template:
        event: "{{ trigger.event }}"

######################################################################################################################  
######################################################################################################################    
#  FAN
###################################################################################################################### 
######################################################################################################################
  ###  DYSON  ###           
- alias: 'Oscillate On'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.fan
      to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.1516402506314
     
- alias: 'Oscillate Off'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.fan
      to: 'off'
  action:
    - service: script.turn_on
      entity_id: script.1516402701204

- alias: "Dyson Fan Speed From Input Boolean"
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_number.dyson_fan_speed
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: '{{ (trigger.to_state.state | int) != (states.fan.salon.attributes.speed|int) }}'
  action:
    - service: fan.set_speed
      entity_id: fan.salon
      data_template:
        speed: '{{states.input_number.dyson_fan_speed.state|int}}'

- alias: "Dyson Fan Speed From Component"
  initial_state: on
  trigger:
    - platform: template
      value_template: '{% if (states.fan.salon.attributes.speed|int) != (states.input_number.dyson_fan_speed.state|int) %}true{%endif%}'
  action:
    - service: input_number.set_value
      entity_id:  input_number.dyson_fan_speed
      data_template:
        value: '{{states.fan.salon.attributes.speed|int}}'

######################################################################################################################  
######################################################################################################################    
#  MOTION
###################################################################################################################### 
######################################################################################################################
  ###  NUIT COULOIR  ###
- alias: If there is motion turn on the Entry light
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_158d0001d556ae
    from: 'off'
    to: 'on'
  condition:
    condition: time  
    after: '23:55:00'
    before: '08:00:00'
  action:
    - service: light.turn_on
      entity_id: light.gateway_light_7811dcb7aac9
      
- alias: If there no motion turn off the entry light
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_158d0001d556ae
    from: 'on'
    to: 'off'
  action:
    - service: light.turn_off
      entity_id: light.gateway_light_7811dcb7aac9
 
  ###  CUISINE JOUR  ###    
- alias: If there is motion turn on the kitchen light
  initial_state: 'on'
  trigger:  
    - platform: state
      entity_id: sensor.fibaro_system_fgms001zw5_motion_sensor_burglar
      from: '0'
      to: '8'  
  condition:
    condition: time  
    after: '20:00:00'
    before: '18:00:00'      
  action:
    - service: light.turn_on
      entity_id: light.cuisine

- alias: If there no motion turn off the kitchen light
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: sensor.fibaro_system_fgms001zw5_motion_sensor_burglar
      from: '8'
      to: '0'
  condition:
    condition: time  
    after: '20:00:00'
    before: '18:00:00' 
  action:
    - service: light.turn_off
      entity_id: light.cuisine      
            
- alias: If there is motion turn on the kitchen light
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: sensor.fibaro_system_fgms001zw5_motion_sensor_burglar
    from: '0'
    to: '3'
  condition:
    condition: time  
    after: '20:00:00'
    before: '18:00:00'      
  action:
    - service: light.turn_on
      entity_id: light.cuisine  

- alias: If there no motion turn off the kitchen light
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: sensor.fibaro_system_fgms001zw5_motion_sensor_burglar
      from: '3'
      to: '0'
  condition:
    condition: time  
    after: '20:00:00'
    before: '18:00:00' 
  action:
    - service: light.turn_off
      entity_id: light.cuisine                    

  ###  PORTE  ###
- alias: 'Alert Pushbullet Door Open'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.door_window_sensor_158d0001de6572
    from: 'off'
    to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.pushbullet_door_open

######################################################################################################################  
######################################################################################################################    
#  ALARM
###################################################################################################################### 
######################################################################################################################
- alias: '[Alarm] Away Mode Armed'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: alarm_control_panel.maison
    to: 'armed_away'
  action:
    - service: notify.pushbullet
      data:
        message: 'Alarm Away Mode Armed'
        target: email/romquenin@gmail.com

- alias: '[Alarm] Home Mode Armed'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: alarm_control_panel.maison
    to: 'armed_home'
  action:
    - service: notify.pushbullet
      data:
        message: 'Alarm Home Mode Armed'
        target: email/romquenin@gmail.com

- alias: '[Alarm] Away Mode Arming'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: alarm_control_panel.maison
    to: 'pending'
  action:
    - service: notify.pushbullet
      data:
        message: 'Alarm Armed Away'
        target: email/romquenin@gmail.com

- alias: '[Alarm] Disarmed'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: alarm_control_panel.maison
    to: 'disarmed'
  action:
    - delay:
        seconds: 1
    - service: script.turn_off
      entity_id:
        - script.xiaomi_alarm_siren
        - script.xiaomi_alarm_siren_loop     
    - service: xiaomi_aqara.stop_ringtone
      data:
        gw_mac: 78:11:DC:B7:AA:C9    
    - service: script.turn_on
      data:   
        entity_id: script.cancel_loop             
    - service: notify.pushbullet
      data:
        message: 'Alarm Disabled'
        target: email/romquenin@gmail.com 
       
- alias: '[Alarm] Disarmed Turn off light'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: alarm_control_panel.maison
    to: 'disarmed'
  action:   
    - delay:
        seconds: 10  
    - service: light.turn_off
      data:
        entity_id: 
        - light.gateway_light_7811dcb7aac9
        - light.salon
        - light.lamp_3          
        

- alias: '[Alarm] Triggered'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: alarm_control_panel.maison
    to: 'triggered'
  action:
    - service: script.turn_on
      entity_id: script.xiaomi_alarm_siren
    - service: script.turn_on
      entity_id: script.light_flash            
    - service: notify.pushbullet
      data:
        message: 'ALARM TRIGGERED!!! {{ states[states.alarm_control_panel.maison.attributes.changed_by.split(".")[0]][ states.alarm_control_panel.maison.attributes.changed_by.split(".")[1]].name }}'
        target: email/romquenin@gmail.com

- alias: '[Alarm] Warning'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: alarm_control_panel.maison
    to: 'warning'
  action:
    - service: notify.pushbullet
      data:
        message: 'ALARM Warning {{ states[states.alarm_control_panel.maison.attributes.changed_by.split(".")[0]][ states.alarm_control_panel.maison.attributes.changed_by.split(".")[1]].name }}'
        target: email/romquenin@gmail.com
                
- alias: 'Boolean RINGTONE ON'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.mute_gateway_sounds
      to: 'on'
  action:
    - service: xiaomi_aqara.stop_ringtone
      data:
        gw_mac: 78:11:DC:B7:AA:C9
    - service: script.turn_on
      entity_id: script.mute_alarm_siren
      
- alias: 'Boolean RINGTONE OFF'
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.mute_gateway_sounds
      to: 'off'
  action:
    - service: script.turn_on
      entity_id: script.unmute_alarm_siren
      
          
       
        
        

